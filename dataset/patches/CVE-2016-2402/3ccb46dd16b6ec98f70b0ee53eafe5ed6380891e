From 456a7456ec673d3e417b1d5f9b3447bf3366d312 Mon Sep 17 00:00:00 2001
From: jwilson <jwilson@squareup.com>
Date: Tue, 9 Feb 2016 11:09:38 -0500
Subject: [PATCH] Don't pay to clean certificates if we aren't pinning.

---
 okhttp/src/main/java/okhttp3/CertificatePinner.java | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/okhttp/src/main/java/okhttp3/CertificatePinner.java b/okhttp/src/main/java/okhttp3/CertificatePinner.java
index ec5b98c2e7c1..e485c87f52a7 100644
--- a/okhttp/src/main/java/okhttp3/CertificatePinner.java
+++ b/okhttp/src/main/java/okhttp3/CertificatePinner.java
@@ -147,14 +147,14 @@ private CertificatePinner(Builder builder) {
    */
   public void check(String hostname, List<Certificate> peerCertificates)
       throws SSLPeerUnverifiedException {
-    if (trustRootIndex != null) {
-      peerCertificates = new CertificateChainCleaner(trustRootIndex).clean(peerCertificates);
-    }
-
     Set<ByteString> pins = findMatchingPins(hostname);
 
     if (pins == null) return;
 
+    if (trustRootIndex != null) {
+      peerCertificates = new CertificateChainCleaner(trustRootIndex).clean(peerCertificates);
+    }
+
     for (int i = 0, size = peerCertificates.size(); i < size; i++) {
       X509Certificate x509Certificate = (X509Certificate) peerCertificates.get(i);
       if (pins.contains(sha1(x509Certificate))) return; // Success!
