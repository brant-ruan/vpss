From f2c9858c02cf521dd05f2c6f8f9450f2e1343090 Mon Sep 17 00:00:00 2001
From: nowhereman <nowheremanmail@gmail.com>
Date: Sun, 10 Jan 2021 21:14:45 +0100
Subject: [PATCH] escape tab characters (#22)

* escape tab characters

* Remove `if` in char escaping switch which is always covered by earlier cases.

Co-authored-by: david galindo <david.galindo@outlook.com>
Co-authored-by: Mike Samuel <mikesamuel@gmail.com>
---
 src/main/java/com/google/json/JsonSanitizer.java | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/main/java/com/google/json/JsonSanitizer.java b/src/main/java/com/google/json/JsonSanitizer.java
index e08fba2..1ae972d 100644
--- a/src/main/java/com/google/json/JsonSanitizer.java
+++ b/src/main/java/com/google/json/JsonSanitizer.java
@@ -513,6 +513,7 @@ private void sanitizeString(int start, int end) {
     for (int i = start; i < end; ++i) {
       char ch = jsonish.charAt(i);
       switch (ch) {
+        case '\t': replace(i, i + 1, "\\t"); break;
         // Fixup newlines.
         case '\n': replace(i, i + 1, "\\n"); break;
         case '\r': replace(i, i + 1, "\\r"); break;
@@ -647,7 +648,9 @@ && isHexAt(i + 4) && isHexAt(i + 5)) {
           //     Char ::= #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD]
           //            | [#x10000-#x10FFFF]
           if (ch < 0x20) {
-            if (ch == 9 || ch == 0xa || ch == 0xd) { continue; }
+             // Proceed to hex-escape below since control characters are
+             // disallowed by ECMA-404 which governs JavaScript's `JSON.parse`.
+             // Common ones like CR, LF, and TAB are given short escape sequences above.
           } else if (ch < 0xd800) {  // Not a surrogate.
             continue;
           } else if (ch < 0xe000) {  // A surrogate
