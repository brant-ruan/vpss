From 75f09367e3dc1451b4a4d89f35d8c3f16bb20bc8 Mon Sep 17 00:00:00 2001
From: mposolda <mposolda@gmail.com>
Date: Thu, 11 Jul 2013 10:34:57 +0200
Subject: [PATCH] Always cleanup buffer after receive diagnostics message

---
 src/org/jgroups/stack/DiagnosticsHandler.java | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/org/jgroups/stack/DiagnosticsHandler.java b/src/org/jgroups/stack/DiagnosticsHandler.java
index dbbd0aa0a48..05a36d38574 100644
--- a/src/org/jgroups/stack/DiagnosticsHandler.java
+++ b/src/org/jgroups/stack/DiagnosticsHandler.java
@@ -108,9 +108,10 @@ public void stop() {
     }
 
     public void run() {
-        byte[] buf=new byte[1500]; // requests are small (responses might be bigger)
+        byte[] buf;
         DatagramPacket packet;
         while(!diag_sock.isClosed() && Thread.currentThread().equals(thread)) {
+            buf=new byte[1500]; // requests are small (responses might be bigger)
             packet=new DatagramPacket(buf, 0, buf.length);
             try {
                 diag_sock.receive(packet);
