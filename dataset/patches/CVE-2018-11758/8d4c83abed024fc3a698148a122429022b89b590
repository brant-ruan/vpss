From 8d4c83abed024fc3a698148a122429022b89b590 Mon Sep 17 00:00:00 2001
From: Nikita Timofeev <stariy95@gmail.com>
Date: Mon, 9 Jul 2018 11:47:12 +0300
Subject: [PATCH] Disable external entities in XML reader

---
 .../src/main/java/org/apache/cayenne/util/Util.java   | 11 +++++------
 1 file changed, 5 insertions(+), 6 deletions(-)

diff --git a/cayenne-server/src/main/java/org/apache/cayenne/util/Util.java b/cayenne-server/src/main/java/org/apache/cayenne/util/Util.java
index 7dfd57e224..6351fe11f2 100644
--- a/cayenne-server/src/main/java/org/apache/cayenne/util/Util.java
+++ b/cayenne-server/src/main/java/org/apache/cayenne/util/Util.java
@@ -261,17 +261,16 @@ public byte[] toByteArray() {
 	 */
 	public static XMLReader createXmlReader() throws SAXException, ParserConfigurationException {
 		SAXParserFactory spf = SAXParserFactory.newInstance();
+		spf.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
+		spf.setFeature("http://xml.org/sax/features/external-general-entities", false);
+		spf.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
+		spf.setFeature("http://xml.org/sax/features/namespaces", true);
 
 		// Create a JAXP SAXParser
 		SAXParser saxParser = spf.newSAXParser();
 
 		// Get the encapsulated SAX XMLReader
-		XMLReader reader = saxParser.getXMLReader();
-
-		// set default features
-		reader.setFeature("http://xml.org/sax/features/namespaces", true);
-
-		return reader;
+		return saxParser.getXMLReader();
 	}
 
 	/**
